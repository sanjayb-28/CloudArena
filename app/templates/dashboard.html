{% extends "base.html" %}
{% block content %}
  <section class="card">
    <h2>Create New Run</h2>
    <p>Kick off a new CloudArena exercise. Goals are optional and help annotate the runbook.</p>
    {% if error %}
      <div class="error">{{ error }}</div>
    {% endif %}
    <form action="/ui/runs" method="post" class="form">
      <label for="goals">Goals</label><br />
      <input type="text" id="goals" name="goals" style="width: 100%; padding: 0.5rem; margin: 0.5rem 0; border-radius: 0.375rem; border: 1px solid #1f2937; background: #0f172a; color: #e2e8f0;" placeholder="Example: Assess public S3 exposure" />
      <input type="submit" value="Create Run" />
    </form>
  </section>

  <section class="card">
    <div style="display: flex; align-items: center; justify-content: space-between; gap: 1rem;">
      <h2 style="margin: 0;">Recent Runs</h2>
      {% if runs %}
        <form action="/ui/runs/clear" method="post" onsubmit="return confirm('Clear all stored runs?');">
          <button type="submit" style="background: #1f2937; color: #f8fafc; border: 1px solid #475569; padding: 0.4rem 0.75rem; border-radius: 0.375rem; cursor: pointer;">Clear Runs</button>
        </form>
      {% endif %}
    </div>
    {% if cleared %}
      <div class="notice" style="margin-top: 0.75rem; color: #38bdf8;">Run history cleared.</div>
    {% endif %}
    {% if runs %}
      <table>
        <thead>
          <tr>
            <th>Run ID</th>
            <th>Created</th>
            <th>Status</th>
            <th>Goals</th>
            <th>Steps</th>
          </tr>
        </thead>
        <tbody>
          {% for run in runs %}
            <tr>
              <td><a href="/ui/runs/{{ run.run_id }}">{{ run.run_id }}</a></td>
              <td>{{ run.created_at }}</td>
              <td>
                {% if run.status %}
                  {% set status_value = run.status %}
                  {% set status_class = status_value | lower | replace(' ', '-') %}
                  <span class="status-badge status-{{ status_class }}">
                    {% if status_class in ["queued", "running"] %}
                      <span class="spinner"></span>
                    {% endif %}
                    {{ status_value | capitalize }}
                  </span>
                {% else %}
                  —
                {% endif %}
              </td>
              <td>{{ run.goals or "—" }}</td>
              <td>{{ run.runbook.get('steps') | length if run.runbook and run.runbook.get('steps') else 0 }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No runs recorded yet.</p>
    {% endif %}
  </section>
{% endblock %}
